<!-- PROJECT LOGO -->
<br />
<p align="center">
  <h2 align="center">Real Time Webex Transcription</h2>

  <p align="center">
   Capture Webex meeting transcription in your <b>Node/Browser</b> application in real time!
  </p>
</p>

<!-- TABLE OF CONTENTS -->
<details open="open">
  <summary>Table of Contents</summary>
  <ol>
    <li>
     <a href="#requirements">Requirements</a>
    <li>
      <a href="#installation">Installation</a>
    </li>
    <li>
      <a href="#usage">Usage</a>
        <ul>
        <li><a href="#browser-environment"> Browser Environment</a></li>
        <li><a href="#node-environment"> Node Environment</a></li>
        <li><a href="#steps"> Steps</a></li>
        </ul>
    </li>
    <li><a href="#license">License</a></li>
    <li><a href="#contact">Contact</a></li>
  </ol>
</details>

</br>

## Requirements

In order for this module to function properly you must have the `Webex Assistant` enabled and have access to the active meeting object in your application which can be retrieved using the WebexJS SDK.

</br>

## Installation

```sh
yarn add @wxsd/webex-transcription   |  npm i @wxsd/webex-transcription
```

</br>

## Usage

### Browser Environment

You can skip this section and start from the <a href="#steps">first step</a>. Browser environment meets all the requirements for this module to be executed properly.

</br>

### Node Environment

This module requires a meeting object that can be retrieved from the meeting plugin offered by WebexJS SDK. Webex Meeting plugin requires a window object that is not available in any node environment at the global level. Therefore, we can either use headless browser OR mock the whole window object and attach it globally to our node environment. Note that we don't need any extra webRTC related features from the meeting plugin for this use case. This is one way to mock the object and attach it globally:
</br>

```js
import Window from "window";

class RTC {
  constructor() {}
}

class mockWindow {
  window: any;

  constructor() {
    this.window = new Window();
    this.window.RTCPeerConnection = RTC;
  }
}

const { window } = new mockWindow();

global.window = window;
```

Now you should be able to utilize the meeting plugin to get the meeting object and pass it to Voicea constructor!
</br>

### Steps

1. Import the library
   ```js
   import Transcription from "@wxsd/webex-transcription";
   ```
2. Create an instance from a given active meeting

   ```js
   // all the active meetings that a user if part of
   const meetings = webex.meetings.meetingCollection.meetings;

   // targeted meeting object
   // const meeting = meetings["meetingID"];

   // first meeting object
   const meeting = Object.values(meetings)[0];

   // create an instance
   const transcription = new Transcription(token, meeting, webex.sessionID);
   ```

3. Connect the application to the webex internal socket connection
   ```js
   await transcription.connect();
   ```
4. You now have access to the meeting transcription payload inside the closure

   ```js
   transcription.getTranscription((trs) => {
     console.log(trs);

     /***
      * Transcription Object Model
      * {
      *    speaker: current speaker
      *    message: current message
      *    type: 'transcript_final_result' || ''transcript_interim_results'
      * }
      **/
   });
   ```

5. This is how your final code should look like

   ```js
   import Webex from "webex";
   import Transcription from "@wxsd/webex-transcription";

   const webex = new Webex(token);

   try {
     await webex.meetings.register();
     await webex.meetings.syncMeetings();

     // all the active meetings that a user if part of
     const meetings = webex.meetings.meetingCollection.meetings;

     // targeted meeting object
     // const meeting = meetings["meetingID"];

     // first meeting object
     const meeting = Object.values(meetings)[0];

     const transcription = new Transcription(token, meeting, webex.sessionID);

     await transcription.connect();

     transcription.getTranscription((trs) => {
       console.log(trs);
     });
   } catch (error) {
     console.log(error);
   }
   ```

<!-- LICENSE -->

## License

Distributed under the MIT License. See `LICENSE` for more information.

<!-- CONTACT -->

## Contact

Arash Koushkebaghi - [LinkedIn](https://www.linkedin.com/in/arash-koushkebaghi-9b1701a4/) - [Github](https://github.com/akoushke)
